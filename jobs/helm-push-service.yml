helm-push-service:
  stage: deploy
  image: dtzar/helm-kubectl:3.11.2
  needs:
    - job: determine-version
      artifacts: true
    - job: build-gradle
      artifacts: true
  variables:
    CHART_NAME: $SERVICE_CHART_NAME
    CHART_VERSION: $GitVersion_SemVer
  script:
    - |
      echo $HELM_PASSWORD | helm registry login $HELM_URL -u $HELM_USER --password-stdin
      echo "helm push /build/helm/charts/$CHART_NAME-$CHART_VERSION.tgz oci://$HELM_URL$HELM_PATH"
      helm push /build/helm/charts/$CHART_NAME-$CHART_VERSION.tgz oci://$HELM_URL$HELM_PATH
  except:
    - merge_request
