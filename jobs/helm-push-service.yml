helm-push-service:
  stage: deploy
  image: dtzar/helm-kubectl:3.11.2
  needs:
    - job: determine-version
      artifacts: true
    - job: build-gradle
      artifacts: true
  variables:
    CHART_NAME: $SERVICE_CHART_NAME
    CHART_VERSION: $GitVersion_SemVer
  script:
    - |
      echo $HELM_PASSWORD | helm registry login $HELM_URL -u $HELM_USER --password-stdin
      build/helm/charts/helm push $CHART_NAME-$CHART_VERSION.tgz oci://$HELM_URL$HELM_PATH/helm
  except:
    - merge_request
